<!DOCTYPE html>
<html>

<head>
	<title>Tunnl.to - Add WireGuard</title>
	<link href="css/bootstrap/bootstrap.css" rel="stylesheet" />
</head>
<style>
	html,
	body {
		width: 100%;
		height: 100%;
		display: flex;
		align-items: center;
		justify-content: center;
	}
</style>

<body>
	<div class="container">
		<form class="requires-validation" novalidate action="index.html">
			<div class="row">
				<!-- Left column start -->
				<div class="col">
					<div class="mb-3">
						<label for="tunnelName" class="form-label">Tunnel Name</label>
						<input id="tunnelName" type="text" class="form-control" id="tunnelName" placeholder="Work VPN"
							required />
					</div>
					<div class="mb-3">
						<label for="interfaceAddress" class="form-label">Interface Address</label>
						<input id="interfaceAddress" type="text" class="form-control" id="interfaceAddress"
							placeholder="10.0.0.1/32" required />
					</div>
					<div class="mb-3">
						<label for="publicKey" class="form-label">Public Key</label>
						<input id="publicKey" type="text" class="form-control" id="publicKey" required />
					</div>
					<div class="mb-3">
						<label for="allowedApps" class="form-label">Allowed Apps</label>
						<input id="allowedApps" type="text" class="form-control" id="allowedApps"
							placeholder="chrome, msoffice" required />
					</div>
				</div>
				<!-- Left column end -->

				<!-- Right column start -->
				<div class="col">
					<div class="mb-3">
						<label for="privateKey" class="form-label">Private Key</label>
						<input id="privateKey" type="text" class="form-control" id="privateKey" required />
					</div>
					<div class="mb-3">
						<label for="dns" class="form-label">DNS</label>
						<input id="dns" type="text" class="form-control" id="dns" placeholder="1.1.1.1, 8.8.8.8" />
					</div>
					<div class="mb-3">
						<label for="endpoint" class="form-label">Endpoint</label>
						<input id="endpoint" type="text" class="form-control" id="endpoint"
							placeholder="10.0.0.100:51820" required />
					</div>
					<div class="mb-3">
						<label for="allowedIps" class="form-label">Allowed IP's</label>
						<input id="allowedIps" type="text" class="form-control" id="allowedIps"
							placeholder="0.0.0.0/0" />
					</div>
				</div>
				<!-- Right column end  -->

				<!-- Button row start -->
				<div class="row mt-3">
					<div class="col">
						<a class="btn btn-secondary" href="index.html" role="button">Back</a>
					</div>
					<div class="col text-end">
						<button class="btn btn-primary" type="submit">Submit form</button>
					</div>
				</div>
				<!-- Button row end -->

			</div>
		</form>
	</div>

	<script src="js/bootstrap/bootstrap.bundle.js"></script>
	<script>
		(function () {
			'use strict'
			const localStorageData = { ...localStorage };

			let options = [];
			for (let x in localStorageData) {
				if (x.startsWith('tunnel-wireguard-')) {
					x = x.replace('tunnel-wireguard-', '');
					options.push({ 'name': x });
					//const tunnelName = JSON.parse(localStorageData[x]).dns;
					console.log(`Pushed ${x} to array`);
				}
			}
			console.log(options);

			const forms = document.querySelectorAll('.requires-validation')
			Array.from(forms)
				.forEach(function (form) {
					form.addEventListener('submit', function (event) {
						if (!form.checkValidity()) {
							event.preventDefault()
							event.stopPropagation()
							console.log('Form not validated');
						} else {
							console.log('Form was validated');

							// Get the form values
							const tunnelName = document.getElementById('tunnelName').value;
							const privateKey = document.getElementById('privateKey').value;
							const interfaceAddress = document.getElementById('interfaceAddress').value;
							const dns = document.getElementById('dns').value;
							const publicKey = document.getElementById('publicKey').value;
							const endpoint = document.getElementById('endpoint').value;
							const allowedApps = document.getElementById('allowedApps').value;
							const allowedIps = document.getElementById('allowedIps').value;

							// Save to local storage
							const wireGuardTunnel = {
								tunnelName: tunnelName,
								privateKey: privateKey,
								interfaceAddress: interfaceAddress,
								dns: dns,
								publicKey: publicKey,
								endpoint: endpoint,
								allowedApps: allowedApps,
								allowedIps: allowedIps
							}
							localStorage.setItem(`tunnel-wireguard-${tunnelName}`, JSON.stringify(wireGuardTunnel));
							console.log(`Saved tunnel-wireguard-${tunnelName} to local storage`);

							// It will redirect at this point as set by the form action
						}

						form.classList.add('was-validated')
					}, false)
				})
		})()

	</script>
</body>

</html>